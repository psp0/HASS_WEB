define(['exports', 'preact/jsx-runtime', './useEffectEvent-04cb4be3', './clientHints-cfef9b8d', './refUtils-280eda7e', 'preact/compat', './TextFieldInput-7f1f701c', './UNSAFE_TextField/themes/ObfuscatedTextFieldInputStyles.css'], (function(e,t,n,s,r,c,o,i){"use strict";class l{constructor({maxHistory:e=100}){this.currentIndex=0,this.maxHistory=e,this.states=[]}get currentState(){return this.states[this.currentIndex]}get isEmpty(){return 0===this.states.length}get hasUndo(){return!this.isEmpty&&this.currentIndex>0}get hasRedo(){return!this.isEmpty&&this.currentIndex<this.states.length-1}push(e){this.currentIndex<this.states.length-1&&(this.states.length=this.currentIndex+1),this.states.push(e),this.states.length>this.maxHistory&&this.states.shift(),this.currentIndex=this.states.length-1}go(e){return this.currentIndex=Math.min(Math.max(this.currentIndex+e,0),this.states.length-1),this.currentState}undo(){return this.go(-1)}redo(){return this.go(1)}clear(){this.states.length=0,this.currentIndex=0}}const a=(e,t,n)=>({content:e.slice(0,t)+e.slice(n),selectionStart:t,selectionEnd:t}),u=(e,t,n)=>n>t?a(e,t,n):0===t?{content:e,selectionStart:t,selectionEnd:n}:{content:e.slice(n),selectionStart:0,selectionEnd:0},d=(e,t,n)=>n>t?a(e,t,n):t===e.length?{content:e,selectionStart:t,selectionEnd:n}:{content:e.slice(0,t),selectionStart:t,selectionEnd:n},h={deleteContentBackward:(e,t,n)=>n>t?a(e,t,n):0===t?{content:e,selectionStart:t,selectionEnd:n}:{content:e.slice(0,t-1)+e.slice(n),selectionStart:t-1,selectionEnd:t-1},deleteContentForward:(e,t,n)=>n>t?a(e,t,n):t===e.length?{content:e,selectionStart:t,selectionEnd:n}:{content:e.slice(0,t)+e.slice(n+1),selectionStart:t,selectionEnd:n},deleteWordBackward:(e,t,n)=>u(e,t,n),deleteWordForward:(e,t,n)=>d(e,t,n),deleteSoftLineBackward:(e,t,n)=>u(e,t,n),deleteSoftLineForward:(e,t,n)=>d(e,t,n),deleteHardLineBackward:(e,t,n)=>u(e,t,n),deleteHardLineForward:(e,t,n)=>d(e,t,n),deleteContent:(e,t,n)=>n>t?a(e,t,n):{content:e,selectionStart:t,selectionEnd:n}},f=["insertText","insertFromPaste"],p=(e,t)=>e===t||!(!e||!t)&&(e.value===t.value&&e.selection.start===t.selection.start&&e.selection.end===t.selection.end);e.ObfuscatedTextFieldInput=({character:e="â€¢",currentCommitValue:a,inputRef:u,isRevealed:d=!1,onCommit:g,onInput:m,type:v="text",value:y,...E})=>{const S=c.useRef({selectionStart:y?.length??0,selectionEnd:y?.length??0}),x=c.useRef(null),C=c.useMemo((()=>r.mergeRefs(u,x)),[u,x]),k=function({state:e,comparator:t,isDisabled:n,maxHistory:s}){const r=c.useRef(s),o=c.useMemo((()=>new l({maxHistory:r.current})),[]),i=c.useRef(!1),a=c.useRef();return t(a.current,e)||n||i.current||(a.current=e,o.push(e)),n&&o.clear(),c.useEffect((()=>()=>o.clear()),[]),c.useMemo((()=>({get hasRedo(){return o.hasRedo},get hasUndo(){return o.hasUndo},redo:()=>o.redo(),undo:()=>o.undo(),ignore(e=!0){i.current=!!e}})),[o])}({comparator:p,isDisabled:d,state:c.useMemo((()=>({value:y??"",selection:{start:S.current.selectionStart,end:S.current.selectionEnd}})),[y])}),I=c.useRef(),R=n.useEffectEvent((e=>{if(x.current!==document.activeElement)return;const{selectionStart:t,selectionEnd:n}=S.current;x.current?.setSelectionRange(t,n)}));c.useLayoutEffect((()=>{R(y)}),[R,y]);const b=c.useCallback((e=>{if(d)return;const t=e.target,{selectionStart:n,selectionEnd:s}=t,r=y??"",c=e.inputType;if(k.ignore(!1),I.current=void 0,o=c,f.includes(o)&&e.data){const t=r.slice(0,n??r.length)+e.data+r.slice(s??r.length),c=(n??r.length)+e.data.length;return S.current={selectionStart:c,selectionEnd:c},void(I.current={previousValue:r,value:t})}var o;if((e=>Object.keys(h).includes(e))(c)){const e=h[c],{content:t,selectionStart:o,selectionEnd:i}=e(r,n??r.length,s??r.length);return S.current={selectionStart:o,selectionEnd:i},void(r!==t&&(I.current={previousValue:r,value:t}))}if(["historyUndo","historyRedo"].includes(e.inputType)){const t="historyUndo"===e.inputType;if(t&&!k.hasUndo||!t&&!k.hasRedo)return;k.ignore();const{value:n,selection:s}=t?k.undo():k.redo();return S.current={selectionStart:s.start,selectionEnd:s.end},void(I.current={previousValue:r,value:n})}e.preventDefault()}),[k,d,y]),w=c.useCallback((()=>{d||I.current&&m?.(I.current)}),[d,m]),F=c.useCallback((()=>{d||x.current?.select()}),[d]),H=c.useCallback((e=>{d||e.preventDefault()}),[d]),T=c.useCallback((e=>{d&&(S.current={selectionStart:x.current?.selectionStart??e.value?.length??0,selectionEnd:x.current?.selectionEnd??e.value?.length??0},m?.(e))}),[d,m]),U=c.useCallback((()=>{a!==y&&g?.({previousValue:a,value:y})}),[a,y,g]),D=c.useCallback((e=>{if(d)return;const t=(e=>{const{platform:t}=s.getClientHints();return"mac"===t&&e.metaKey&&!e.shiftKey&&"z"===e.key||"windows"===t&&e.ctrlKey&&"z"===e.key})(e),n=(e=>{const{platform:t}=s.getClientHints();return"mac"===t&&e.metaKey&&e.shiftKey&&"z"===e.key||"windows"===t&&e.ctrlKey&&"y"===e.key})(e);if(t||n){if(t&&!k.hasUndo||n&&!k.hasRedo)return;e.preventDefault(),k.ignore();const{value:s,selection:r}=t?k.undo():k.redo();return S.current={selectionStart:r.start,selectionEnd:r.end},void m?.({previousValue:y,value:s})}}),[k,d,m,y]);return t.jsx("div",{class:i.containerStyles,onBeforeInput:b,onInput:w,onCut:H,onCopy:H,onDblClick:F,onContextMenu:F,children:t.jsx(o.TextFieldInput,{...E,as:"input",autoComplete:"off",currentCommitValue:a,type:v,spellcheck:!1,inputRef:C,onInput:T,onCommit:U,onKeyDown:D,value:d?y:e.repeat(y?.length??0)})})}}));
//# sourceMappingURL=ObfuscatedTextFieldInput-23ddd580.js.map
