define(["require","exports","ojs/ojarraydataprovider","ojs/ojmutablearraydataprovider","knockout","../common/dataAccessService","../common/localizedConstants","../common/scriptExecutionModels","../common/messageService","ojs/ojcontext","../common/filterModels","ojs/ojbutton","ojs/ojcheckboxset","ojs/ojknockout","ojs/ojinputtext","ojs/ojlabel","ojs/ojselectcombobox","ojs/ojmessage","ojs/ojmessages","ojs/ojlistview","ojs/ojselector","ojs/ojradioset","ojs/ojpopup","ojs/ojinputnumber","ojs/ojlistitemlayout","ojs/ojdialog","ojs/ojdatetimepicker"],(function(require,e,t,i,l,s,r,o,a,n,h){"use strict";return class{constructor(e){this.filterUITexts=new h.FilterUITexts,this.collectionName=l.observable(),this.collectionType=l.observable(o.FilterCollectionType.Connection),this.noData=l.observable(!1),this.enableCheckboxes=l.observableArray([]),this.onEnableChanged=()=>{this.filters.size>0&&this.signalIfChanges()},this.match=l.observable(o.FilterMatch.All),this.onMatchChanged=e=>{this.filters.size>0&&this.signalIfChanges()},this.connectionCollType=o.FilterCollectionType.Connection,this.matchAllEnum=o.FilterMatch.All,this.matchAnyEnum=o.FilterMatch.Any,this.objectNamePropertyType=o.FilterPropertiesType.ObjectName,this.parentObjectNamePropertyType=o.FilterPropertiesType.ParentObjectName,this.parentOwnerNamePropertyType=o.FilterPropertiesType.ParentObjectOwnerName,this.statusPropertyType=o.FilterPropertiesType.Status,this.triggerStatusPropertyType=o.FilterPropertiesType.TriggerStatus,this.debugPropertyType=o.FilterPropertiesType.CompilationMode,this.visibleCollectionsPropertyType=o.FilterPropertiesType.VisibleCollections,this.createdDatePropertyType=o.FilterPropertiesType.CreatedDate,this.modifiedDatePropertyType=o.FilterPropertiesType.ModifiedDate,this.objectCountPropertyType=o.FilterPropertiesType.ObjectCount,this.betweenConditionType=o.FilterConditionsType.Between,this.notBetweenConditionType=o.FilterConditionsType.NotBetween,this.strYes="yes",this.deleteStr=r.LocalizedConstants.Instance.deleteStr,this.enableFilters=h.FilterEnable.EnableFiltersForExplorer,this.enableFiltersForIntellisense=h.FilterEnable.EnableFiltersForIntellisense,this.filters=new Map,this.propertyOptionsObjectName={value:o.FilterPropertiesType.ObjectName,label:this.filterUITexts.pObjectName},this.propertyOptionCreatedDate={value:o.FilterPropertiesType.CreatedDate,label:this.filterUITexts.pCreatedDate},this.propertyOptionModifiedDate={value:o.FilterPropertiesType.ModifiedDate,label:this.filterUITexts.pModifiedDate},this.propertyOptionCompileMode={value:o.FilterPropertiesType.CompilationMode,label:this.filterUITexts.pCompilation},this.propertyOptionStatus={value:o.FilterPropertiesType.Status,label:this.filterUITexts.pStatus},this.propertyOptionTriggerStatus={value:o.FilterPropertiesType.TriggerStatus,label:this.filterUITexts.pTriggerStatus},this.propertyOptionsConnection=[this.propertyOptionsObjectName],this.propertyOptionObjectCount={value:o.FilterPropertiesType.ObjectCount,label:this.filterUITexts.pObjectCount},this.propertyParentObjectName={value:o.FilterPropertiesType.ParentObjectName,label:this.filterUITexts.pParentName},this.propertyParentOwnerName={value:o.FilterPropertiesType.ParentObjectOwnerName,label:this.filterUITexts.pParentOwner},this.conditionOptionsObjectName=[{value:o.FilterConditionsType.Is,label:this.filterUITexts.cIs},{value:o.FilterConditionsType.IsNot,label:this.filterUITexts.cIsNot},{value:o.FilterConditionsType.StartsWith,label:this.filterUITexts.cStarts},{value:o.FilterConditionsType.EndsWith,label:this.filterUITexts.cEnds},{value:o.FilterConditionsType.Contains,label:this.filterUITexts.cContains},{value:o.FilterConditionsType.DoesNotContain,label:this.filterUITexts.cNotContains}],this.conditionOptionsOther=[{value:o.FilterConditionsType.Is,label:this.filterUITexts.cIs}],this.conditionOptionsRange=[{value:o.FilterConditionsType.EqualTo,label:this.filterUITexts.cEqualTo},{value:o.FilterConditionsType.NotEqualTo,label:this.filterUITexts.cNotEqualTo},{value:o.FilterConditionsType.LessThan,label:this.filterUITexts.cLessThan},{value:o.FilterConditionsType.LessThanOrEqualTo,label:this.filterUITexts.cLessThanOrEqual},{value:o.FilterConditionsType.GreaterThan,label:this.filterUITexts.cGreaterThan},{value:o.FilterConditionsType.GreaterThanOrEqualTo,label:this.filterUITexts.cGreaterThanOrEqual},{value:o.FilterConditionsType.Between,label:this.filterUITexts.cBetween},{value:o.FilterConditionsType.NotBetween,label:this.filterUITexts.cNotBetween}],this.debugOptions=l.observableArray([{value:o.CodeObjectDebug.WithoutDebug,label:this.filterUITexts.modeWoDebug},{value:o.CodeObjectDebug.WithDebug,label:this.filterUITexts.modeDebug}]),this.debugOptionsDP=new t(this.debugOptions,{keyAttributes:"value"}),this.statusOptions=l.observableArray([{value:o.CodeObjectStatus.Valid,label:this.filterUITexts.statusValid},{value:o.CodeObjectStatus.Invalid,label:this.filterUITexts.statusInvalid}]),this.statusOptionsDP=new t(this.statusOptions,{keyAttributes:"value"}),this.triggerStatusOptions=l.observableArray([{value:o.TriggerStatus.Enabled,label:this.filterUITexts.statusEnabled},{value:o.TriggerStatus.Disabled,label:this.filterUITexts.statusDisabled}]),this.triggerStatusOptionsDP=new t(this.triggerStatusOptions,{keyAttributes:"value"}),this.containerHeight=l.observable({}),this.disableOkButton=l.observable(!1),this.propertyChangedIndex=l.observable(-1),this.overrideCheckbox=l.observableArray([]),this.onOverrideChanged=e=>{this.filters.size>0&&this.signalIfChanges()},this.doDisableCheckboxes=l.observable(!1),this.openPopup=(e,t)=>{if(!this.visibleCollectionsStrings())return;const i=document.getElementById("visCollPopupId");i&&(i.setAttribute("data-hover","true"),setTimeout((()=>{"true"==i.getAttribute("data-hover")&&i.open("#visCollValueDiv")}),400))},this.closePopup=(e,t)=>{const i=document.getElementById("visCollPopupId");i&&(i.setAttribute("data-hover","false"),i.isOpen&&i.close())},this.onPropertyOptionChanged=(e,t)=>{const i=t.data;if(i&&this.filters.has(i.index)){const t=this.filters.get(i.index);t&&e.detail&&(t.property=e.detail.value,t.condition=o.FilterConditionsType.Is,i.row.conditionValue(t.condition),t.value=this.getPropertyValue(e.detail.value),i.row.valueValue(t.value),void 0!==e.detail.previousValue&&this.updatePropertyDropdowns(e.detail.value,e.detail.previousValue,i.index)),this.signalIfChanges()}},this.onConditionValueChanged=(e,t)=>{const i=t.data;i&&this.filters.has(i.index)&&(void 0!==e.detail?.value&&(this.filters.get(i.index).condition=e.detail?.value),this.signalIfChanges())},this.setDisplayDateTooltip=(e,t,i)=>{e&&e.detail&&t&&t&&("upper"==i?t.upperRawValue(e.detail.value):t.lowerRawValue(e.detail.value))},this.onLowerLimitChanged=(e,t)=>{const i=t.data;if(i&&this.filters.has(i.index)){i.lowerRawValue(e.detail.value);let t=this.formatNumberString(i.upperRawValue()),l=this.formatNumberString(i.lowerRawValue());null==i.upperRawValue()||""==i.upperRawValue()||null==i.lowerRawValue()||""==i.lowerRawValue()||t>l?(this.filters.get(i.index).lowerLimit=this.formatNumberString(e.detail.value),this.filters.get(i.index).upperLimit=t,i.errorMsg(void 0)):(this.filters.get(i.index).lowerLimit=void 0,i.errorMsg(this.filterUITexts.invalidObjRangeMsg))}this.signalIfChanges()},this.onUpperLimitChanged=(e,t)=>{const i=t.data;if(i&&this.filters.has(i.index)){i.upperRawValue(e.detail.value);let t=this.formatNumberString(i.upperRawValue()),l=this.formatNumberString(i.lowerRawValue());null==i.lowerRawValue()||""==i.lowerRawValue()||null==i.upperRawValue()||""==i.upperRawValue()||t>l?(this.filters.get(i.index).lowerLimit=l,this.filters.get(i.index).upperLimit=this.formatNumberString(e.detail.value),i.errorMsg(void 0)):(this.filters.get(i.index).upperLimit=void 0,i.errorMsg(this.filterUITexts.invalidObjRangeMsg))}this.signalIfChanges()},this.onNumberChanged=(e,t)=>{const i=t.data;i&&this.filters.has(i.index)&&(this.filters.get(i.index).value=this.formatNumberString(e.detail?.value)),this.signalIfChanges()},this.onValueChanged=(e,t)=>{const i=t.data;i&&this.filters.has(i.index)&&(this.filters.get(i.index).value=e.detail?.value),this.signalIfChanges()},this.onDateValueChanged=(e,t,i)=>{t&&this.filters.has(t.index)&&("lower"==i?this.filters.get(t.index).lowerLimit=e.detail?.value:"upper"==i?this.filters.get(t.index).upperLimit=e.detail?.value:this.filters.get(t.index).value=e.detail?.value),this.signalIfChanges()},this.onCaseChanged=(e,t)=>{const i=t.data;i&&this.filters.has(i.index)&&(this.filters.get(i.index).caseSensitiveMatch=!!e.detail.value&&e.detail.value.length>0),this.signalIfChanges()},this.preventAnimation=e=>{let t=e.detail;"open"!==t.action&&"close"!==t.action||(e.preventDefault(),t.endCallback())},this.onRemoveFilterSetting=(e,t,i)=>{let l=t?.data;l&&this.removeFilter(l.index,l.rowId)},this.filterModuleCounter=0,this.disableAddFilterButton=l.observable(!1),this.onAddFilter=e=>{this.doAddFilterSetting()},this.preventInput=(e,t,i)=>{if("Backspace"==e.key||"Delete"==e.key){const e=t;e&&("upper"==i?e.row.upperValue(""):"lower"==i?e.row.lowerValue(""):e.row.valueValue(""))}else"Tab"!=e.key&&"ArrowLeft"!=e.key&&"ArrowRight"!=e.key&&"Home"!=e.key&&"End"!=e.key&&e.preventDefault()},this.preventNonDigits=e=>{(e&&e.key<"0"||e.key>"9"&&"Backspace"!=e.key&&"Tab"!=e.key&&"ArrowLeft"!=e.key&&"ArrowRight"!=e.key&&"Home"!=e.key&&"End"!=e.key&&"Delete"!=e.key)&&e.preventDefault()},this.allCollectionsVisible=l.observableArray(),this.visibleCollectionsValue=l.observableArray([]),this.visibleCollectionOptions=l.observableArray([{value:o.FilterCollectionType.RelationalTables,label:this.filterUITexts.ctRelationalTables},{value:o.FilterCollectionType.ObjectTables,label:this.filterUITexts.ctObjectTables},{value:o.FilterCollectionType.XMLTables,label:this.filterUITexts.ctXMLTables},{value:o.FilterCollectionType.RelationalViews,label:this.filterUITexts.ctRelationalViews},{value:o.FilterCollectionType.ObjectViews,label:this.filterUITexts.ctObjectViews},{value:o.FilterCollectionType.XMLViews,label:this.filterUITexts.ctXMLViews},{value:o.FilterCollectionType.MaterializedViews,label:this.filterUITexts.ctMaterializedViews},{value:o.FilterCollectionType.Procedures,label:this.filterUITexts.ctProcedures},{value:o.FilterCollectionType.Functions,label:this.filterUITexts.ctFunctions},{value:o.FilterCollectionType.Packages,label:this.filterUITexts.ctPackages},{value:o.FilterCollectionType.Sequences,label:this.filterUITexts.ctSequences},{value:o.FilterCollectionType.Synonyms,label:this.filterUITexts.ctSynonyms},{value:o.FilterCollectionType.TableTriggers,label:this.filterUITexts.ctTableTriggers},{value:o.FilterCollectionType.ViewTriggers,label:this.filterUITexts.ctViewTriggers},{value:o.FilterCollectionType.SchemaTriggers,label:this.filterUITexts.ctSchemaTriggers},{value:o.FilterCollectionType.DatabaseTriggers,label:this.filterUITexts.ctDBTriggers},{value:o.FilterCollectionType.OtherUsers,label:this.filterUITexts.ctOtherUsers}]),this.allCollVisComp=l.computed({owner:this,read:()=>this.allCollectionsVisible(),write:e=>{e.indexOf(this.strYes)>-1?(this.setVisibleCollections(!0),this.allCollectionsVisible.push(this.strYes)):(this.setVisibleCollections(!1),this.allCollectionsVisible.removeAll())}}),this.visibleCollectionOptionsDP=new i(this.visibleCollectionOptions(),{keyAttributes:"value"}),this.onOKVizColl=(e,t,i)=>{document.getElementById("editVisibleCollectionsUIID").close(),this.filters.forEach((e=>{e.property===o.FilterPropertiesType.VisibleCollections&&(0==this.visibleCollectionsValue().length?this.visibleCollectionsValue(e.value):e.value=this.visibleCollectionsValue())})),this.signalIfChanges()},this.editedVisibleCollectionsValue=[],this.onEditVisibleCollections=e=>{document.getElementById("editVisibleCollectionsUIID").open(),this.editedVisibleCollectionsValue=this.visibleCollectionsValue()},this.onCancelVizColl=e=>{const t=document.getElementById("editVisibleCollectionsUIID");t.isOpen()&&t.close(),this.visibleCollectionsValue(this.editedVisibleCollectionsValue)},this.updateVisCollValue=e=>{e&&e.detail&&e.detail.originalEvent&&"Escape"==e.detail.originalEvent?.key&&this.visibleCollectionsValue(this.editedVisibleCollectionsValue)},this.visibleCollectionsStrings=l.computed({owner:this,read:()=>{let e=[],t=new Set(this.visibleCollectionsValue());return this.visibleCollectionOptions().forEach((i=>{t.has(i.value)&&e.push(i.label)})),e.join(", ")}}),this.onVisCollChanged=e=>{e&&e.detail&&e.detail.value&&(this.visibleCollectionsValue(e.detail.value),this.disableOkButton(0==this.visibleCollectionsValue().length),this.visibleCollectionsValue().length==this.visibleCollectionOptions().length?this.allCollectionsVisible.push(this.strYes):this.allCollectionsVisible.removeAll())},e&&(this.connectionName=e.connectionName,this.changesSignalFromCollection=e.changesSignalFromCollection,this.adjustFilterContainerHeight=e.adjustFilterContainerHeight,this.moduleId=e.collFilter?.id),s.DataAccessService.instance.logInfo("Fetching Localized resources "),s.DataAccessService.instance.getLocalizedData().done((e=>{s.DataAccessService.instance.logInfo("Fetched localized resources."),r.LocalizedConstants.Instance.Configure(e),this.filterUITexts=new h.FilterUITexts})).fail((e=>{s.DataAccessService.instance.logError("Localized resources "+JSON.stringify(e))})),this.setSavedFilter(e.collFilter)}get defaultCollectionTypesCount(){return this.visibleCollectionOptions().length}updatePropertyDropdowns(e,t,i){(this.isUniqueProperty(e)||this.isUniqueProperty(t))&&(i===this.propertyChangedIndex()?this.propertyChangedIndex.notifySubscribers():this.propertyChangedIndex(i))}isUniqueProperty(e){switch(e){case o.FilterPropertiesType.CompilationMode:case o.FilterPropertiesType.Status:case o.FilterPropertiesType.TriggerStatus:return!0}return!1}getPropertyValue(e){switch(e){case o.FilterPropertiesType.ObjectName:return"";case o.FilterPropertiesType.CompilationMode:return o.CodeObjectDebug.WithoutDebug;case o.FilterPropertiesType.Status:return o.CodeObjectStatus.Valid;case o.FilterPropertiesType.TriggerStatus:return o.TriggerStatus.Enabled}}formatNumberString(e){return void 0!==e&&""!==e?parseInt(e.replace(/,/g,"")):void 0}signalIfChanges(){this.collectionType()===o.FilterCollectionType.Connection?this.noData(!this.filters||this.filters.size<=1):this.noData(!this.filters||0==this.filters.size),this.disableAddFilterButton(this.shouldDisableAddFilter()),this.doDisableCheckboxes(this.shouldDisableCheckboxes());let e=this.getActiveSetting();this.changesSignalFromCollection(e)}removeNode(e){const t=document.getElementById(e);t&&t.remove()}removeFilter(e,t){t||(t=this.getFilterRowName(e));let i=this.filters.get(e);this.filters.delete(e),this.removeNode(t),this.updatePropertyDropdowns(i.property,null,e),this.signalIfChanges()}doAddFilterSetting(){try{let e=this.filterModuleCounter++,t=new h.FilterSettingRow(e);t.propertyValue=l.observable(o.FilterPropertiesType.ObjectName),t.conditionValue=l.observable(o.FilterConditionsType.Is),t.valueValue=l.observable(),t.lowerValue=l.observable(),t.upperValue=l.observable(),t.caseSensitive=l.observableArray([]),this.filters.set(e,new o.FilterItem(t.propertyValue(),t.conditionValue(),t.valueValue(),e,t.caseSensitive().length>0,t.lowerValue(),t.upperValue())),this.addFilterModule(t),this.signalIfChanges()}catch(e){s.DataAccessService.instance.logError(e)}}shouldDisableAddFilter(){if(!this.filters||0==this.filters.size)return!1;if(this.collectionType()==o.FilterCollectionType.Connection&&1==this.filters.size)return!1;let e=!1;return this.filters.forEach(((t,i)=>{this.isFilterValueInvalid(t)&&(e=!0)})),e}isFilterValueInvalid(e){return e.property!==o.FilterPropertiesType.VisibleCollections&&(e.condition==o.FilterConditionsType.Between||e.condition==o.FilterConditionsType.NotBetween?this.isValueInvalid(e.upperLimit)||this.isValueInvalid(e.lowerLimit):this.isValueInvalid(e.value))}isValueInvalid(e){return null==e||""===e}shouldDisableCheckboxes(){if(!this.filters||0==this.filters.size)return!0;let e=!1;return this.filters.forEach(((t,i)=>{t.property===o.FilterPropertiesType.VisibleCollections?t.value?.length!==this.defaultCollectionTypesCount&&(e=!0):this.isFilterValueInvalid(t)||(e=!0)})),!e}createId(e,t){return e+this.moduleId+"_"+t}get filterOuterContainerId(){return"filterOuterContainer"+this.moduleId}getFilterRowName(e){return this.createId("filterModule",e)}get valueControlName(){return"filterValueControl"}addFilterModule(e,t=!1){try{const s=document.querySelector("#"+this.filterOuterContainerId);if(s){let r=document.querySelector("#filterModuleTemplate");const a=r.content.cloneNode(!0).firstElementChild;a.setAttribute("id",this.getFilterRowName(e.id)),s.appendChild(a);let n=new h.FilterRowData;n.rowId=this.getFilterRowName(e.id),n.row=e,n.index=e.id;const p=new i([],{keyAttributes:"value"});n.propertyOptions=l.computed({read:()=>(this.propertyChangedIndex(),p.data=this.getFilterPropertyDP(e.id),p),disposeWhenNodeIsRemoved:a});let c=new i([],{keyAttributes:"value"}),u=!0;n.conditionOptions=l.computed({read:()=>{switch(n.row.propertyValue()){case o.FilterPropertiesType.ObjectName:case o.FilterPropertiesType.ParentObjectName:case o.FilterPropertiesType.ParentObjectOwnerName:c.data=this.conditionOptionsObjectName,u||n.row.conditionValue(o.FilterConditionsType.Is);break;case o.FilterPropertiesType.CreatedDate:case o.FilterPropertiesType.ModifiedDate:case o.FilterPropertiesType.ObjectCount:c.data=this.conditionOptionsRange,u||n.row.conditionValue(o.FilterConditionsType.EqualTo);break;default:c.data=this.conditionOptionsOther,u||n.row.conditionValue(o.FilterConditionsType.Is)}return u=!1,c},disposeWhenNodeIsRemoved:a}),n.parent=this,n.valueControlId=this.createId(this.valueControlName,e.id),n.visPopupId=this.createId("visCollPopup",e.id),n.visContainerId=this.createId("visCollTextContainer",e.id);let d={data:n};l.applyBindings(d,a),t||this.focusValueElement(s,n.valueControlId)}}catch(e){s.DataAccessService.instance.logError(e)}}focusLastValueElementIfEmpty(){if(this.filters.size>0){const e=Array.from(this.filters.keys()).pop(),t=this.filters.get(e);if(t&&this.isValueInvalid(t.value)){const t=document.querySelector("#"+this.filterOuterContainerId),i=this.createId(this.valueControlName,e);this.focusValueElement(t,i)}}}focusValueElement(e,t){e&&n.getContext(e).getBusyContext().whenReady().then((()=>{const e=document.getElementById(t);e&&e.focus()}))}onFilterSaveToCollection(e){try{if(e===this.collectionType()){let e=this.getActiveSetting();this.setSavedFilter(e)}}catch(e){s.DataAccessService.instance.logError(e)}}populateUI(e){try{s.DataAccessService.instance.logInfo("Populating UI with saved filter settings"),this.collectionName(e.collectionName),this.collectionType(e.collectionType),e.enableFiltersForExplorer?this.enableCheckboxes.push(this.enableFilters):this.enableCheckboxes.remove(this.enableFilters),e.enableFiltersForIntellisense?this.enableCheckboxes.push(this.enableFiltersForIntellisense):this.enableCheckboxes.remove(this.enableFiltersForIntellisense),this.match=l.observable(e.match),this.filters.clear();let t=!1;e.collectionType===o.FilterCollectionType.Connection?(this.visibleCollectionsValue([]),t=!0):e.overrideConnectionFilter?this.overrideCheckbox.push(this.strYes):this.overrideCheckbox.remove(this.strYes),e.filters.forEach((e=>{e.id=this.filterModuleCounter++,t&&e.property==o.FilterPropertiesType.VisibleCollections&&(t=!1),this.filters.set(e.id,e)}));let i=!0;e.collectionType===o.FilterCollectionType.Connection?(t&&(this.allCollVisComp([this.strYes]),this.filters.set(this.filterModuleCounter++,new o.FilterItem(o.FilterPropertiesType.VisibleCollections,o.FilterConditionsType.Is,this.visibleCollectionsValue(),this.filterModuleCounter-1,!1))),1==this.filters.size&&(i=!1,this.doAddFilterSetting())):0==this.filters.size&&(i=!1,this.doAddFilterSetting()),n.getPageContext().getBusyContext().whenReady().then((()=>{this.createFilterEltsInDOM(i),this.adjustFilterContainerHeight()})),this.signalIfChanges()}catch(e){s.DataAccessService.instance.logError(e)}}createFilterEltsInDOM(e){try{this.filters.forEach(((t,i)=>{const s=new h.FilterSettingRow;s.id=i,s.propertyValue=l.observable(t.property),s.conditionValue=l.observable(t.condition),s.caseSensitive=l.observableArray(t.caseSensitiveMatch?[this.strYes]:[]),s.lowerValue=l.observable(),s.upperValue=l.observable(),s.valueValue=l.observable(),t.property===o.FilterPropertiesType.VisibleCollections?(s.valueValue(t.value),this.visibleCollectionsValue(t.value)):t.condition==o.FilterConditionsType.Between||t.condition==o.FilterConditionsType.NotBetween?t.property==o.FilterPropertiesType.CreatedDate||t.property==o.FilterPropertiesType.ModifiedDate?(s.lowerValue(t.lowerLimit),s.upperValue(t.upperLimit)):(s.lowerValue=l.observable(parseInt(t.lowerLimit)),s.upperValue=l.observable(parseInt(t.upperLimit))):t.property==o.FilterPropertiesType.CreatedDate||t.property==o.FilterPropertiesType.ModifiedDate?s.valueValue(t.value):t.property==o.FilterPropertiesType.ObjectCount?s.valueValue(parseInt(t.value)):s.valueValue(t.value),t.property!==o.FilterPropertiesType.VisibleCollections&&this.addFilterModule(s,e)}))}catch(e){s.DataAccessService.instance.logError(e)}}isChecked(e){return e===h.FilterEnable.EnableFiltersForExplorer?-1!==this.enableCheckboxes().indexOf(this.enableFilters):-1!==this.enableCheckboxes().indexOf(this.enableFiltersForIntellisense)}updateEnableDisableAll(e){switch(e){case h.FilterEnableAll.EnableAllExplorer:this.enableCheckboxes.push(this.enableFilters);break;case h.FilterEnableAll.DisableAllExplorer:this.enableCheckboxes.remove(this.enableFilters);break;case h.FilterEnableAll.EnableAllIntellisense:this.enableCheckboxes.push(this.enableFiltersForIntellisense);break;case h.FilterEnableAll.DisableAllIntellisense:this.enableCheckboxes.remove(this.enableFiltersForIntellisense)}}changesMade(){try{let e=!1;this.match()===this.savedCollectionFilter.match&&this.isChecked(h.FilterEnable.EnableFiltersForExplorer)===this.savedCollectionFilter.enableFiltersForExplorer&&this.isChecked(h.FilterEnable.EnableFiltersForIntellisense)===this.savedCollectionFilter.enableFiltersForIntellisense||(e=!0);let t=this.overrideCheckbox.indexOf(this.strYes)>-1;(t&&!this.savedCollectionFilter.overrideConnectionFilter||!t&&this.savedCollectionFilter.overrideConnectionFilter)&&(e=!0);let i,l=new Set,s=new Set;for(let e=0;e<this.savedCollectionFilter.filters.length;e++)i=this.getUniqueFilterString(this.savedCollectionFilter.filters[e]),i&&l.add(i);if(this.filters.forEach(((e,t)=>{i=this.getUniqueFilterString(e),i&&s.add(i)})),l.size!==s.size)return!0;for(const e of l)if(!s.has(e))return!0;return e&&s.size>0}catch(e){return s.DataAccessService.instance.logError(e),!1}}getUniqueFilterString(e){if(e){let t=e.property+"_"+e.condition+"_";switch(e.property){case o.FilterPropertiesType.VisibleCollections:if(e.value){if(e.value?.length==this.defaultCollectionTypesCount)return null;e.value?.forEach((e=>{t+=e}))}break;case o.FilterPropertiesType.CreatedDate:case o.FilterPropertiesType.ModifiedDate:case o.FilterPropertiesType.ObjectCount:if(e.condition===o.FilterConditionsType.Between||e.condition===o.FilterConditionsType.NotBetween){if(void 0===e.lowerLimit||""===e.lowerLimit||void 0===e.upperLimit||""===e.upperLimit)return null;t+=e.lowerLimit+"_"+e.upperLimit}else{if(void 0===e.value||""===e.value)return null;t+=e.value}break;case o.FilterPropertiesType.ObjectName:case o.FilterPropertiesType.ParentObjectName:case o.FilterPropertiesType.ParentObjectOwnerName:if(!e.value)return null;t+=e.value+"_"+e.caseSensitiveMatch;break;default:if(void 0===e.value)return null;t+=e.value}return t}return null}getActiveSetting(){try{let e=[];this.filters.forEach(((t,i)=>{t.property==o.FilterPropertiesType.VisibleCollections?t.value.length!=this.defaultCollectionTypesCount&&e.push(t):e.push(t)}));let t=new o.CollectionFilterInfo(this.collectionType(),this.collectionName(),this.enableCheckboxes.indexOf(this.enableFilters)>-1,this.enableCheckboxes.indexOf(this.enableFiltersForIntellisense)>-1,this.overrideCheckbox.indexOf(this.strYes)>-1,this.match(),e,this.moduleId);return t.hasChanged=this.changesMade(),t}catch(e){s.DataAccessService.instance.logError(e)}return null}getFilterPropertyDP(e){let t=[this.propertyOptionsObjectName];try{switch(this.collectionType()){case o.FilterCollectionType.Connection:t=this.propertyOptionsConnection;break;case o.FilterCollectionType.Procedures:case o.FilterCollectionType.Functions:case o.FilterCollectionType.Packages:t.push(this.propertyOptionCreatedDate),t.push(this.propertyOptionModifiedDate);let i=!0,l=!0;this.filters.forEach((e=>{switch(e.property){case o.FilterPropertiesType.CompilationMode:i=!1;break;case o.FilterPropertiesType.Status:l=!1}}));let s=this.filters.get(e)?.property;(s===o.FilterPropertiesType.CompilationMode||i)&&t.push(this.propertyOptionCompileMode),(s===o.FilterPropertiesType.Status||l)&&t.push(this.propertyOptionStatus);break;case o.FilterCollectionType.Triggers:let r=!0,a=!0;this.filters.forEach((e=>{switch(e.property){case o.FilterPropertiesType.CompilationMode:r=!1;break;case o.FilterPropertiesType.TriggerStatus:a=!1}}));let n=this.filters.get(e)?.property;(n===o.FilterPropertiesType.CompilationMode||r)&&t.push(this.propertyOptionCompileMode),(n===o.FilterPropertiesType.TriggerStatus||a)&&t.push(this.propertyOptionTriggerStatus);break;case o.FilterCollectionType.OtherUsers:t.push(this.propertyOptionObjectCount);break;case o.FilterCollectionType.Tables:case o.FilterCollectionType.Views:t.push(this.propertyOptionCreatedDate),t.push(this.propertyOptionModifiedDate);break;case o.FilterCollectionType.Synonyms:t.push(this.propertyParentObjectName),t.push(this.propertyParentOwnerName)}}catch(e){s.DataAccessService.instance.logError(e)}return t}setSavedFilter(e){if(e){let t=[];e.filters.forEach((e=>t.push(new o.FilterItem(e.property,e.condition,e.value,e.id,e.caseSensitiveMatch,e.lowerLimit,e.upperLimit)))),this.savedCollectionFilter=new o.CollectionFilterInfo(e.collectionType,e.collectionName,e.enableFiltersForExplorer,e.enableFiltersForIntellisense,e.overrideConnectionFilter,e.match,t,this.moduleId)}}initialize(e,t){s.DataAccessService.instance.logInfo("Start initializing collectionFiltersModule"),a.MessagesService.getinstance().ClearAll(),this.populateUI(e),s.DataAccessService.instance.logInfo("End initializing")}static getModuleName(e){return"collModule"+e}setVisibleCollections(e){this.visibleCollectionsValue([]),e&&this.visibleCollectionOptions().forEach((e=>{this.visibleCollectionsValue.push(e.value)}))}}}));